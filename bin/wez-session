#!/bin/bash

file=~/.dotfiles/.profile/tmux-workspaces

if [[ -e "$file" ]]; then
    IFS=$'\n'
    read -d '' -r -a dirs < $file
else
    dirs=(
        ~/repos
    )
fi

if [[ $# -eq 1 ]]; then
    selected=$1
else
    selected=$(find ${dirs[@]} -mindepth 1 -maxdepth 1 -type d | fzf)
fi



if [[ -z $selected ]]; then
    exit 0
fi

selected_name=$(basename "$selected" | tr . _)
# tmux_running=$(pgrep wezterm cli list --format json | jq "map(.workspace) | unique")

if [[ -z ${WEZTERM_PANE=x} ]] && [[ -z $tmux_running ]]; then
    echo "WEZTERM not running"
    exit 0
fi

session_exists=$(wezterm cli list --format json | jq 'map(.workspace) | index( "'$selected_name'" )')
echo $session_exists

if [[ -z ${session_exists} ]]; then
    echo "no"
    wezterm cli spawn --new-window --workspace $selected_name --cwd $selected
fi

wezterm cli switch --workspace $selected_name
